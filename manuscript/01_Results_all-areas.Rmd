---
title: "Results - all areas"
author: "Lola Gilbert"
date: "24/03/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
```

This project is available on 
_[github](https://github.com/Lola-san/Cetacean.excretion.global.git)_

# Nutrient cycling in the photic zone through cetacean populations

## Comparison between areas

To compare the contribution of cetacean populations to the fertilization of the photic zone between different areas (of different sizes), we computed a "density" of fertilization, considering an homogeneous distribution of cetaceans within each area. 

### All elements, all cetacean groups

Table with all results, with 95% CI intervals limits, with results as quantities (tons per year) and not densities: 

```{r  echo=FALSE, fig.align="center"}
# to disable scientific notations
options(scipen = 999)

kableExtra::kable(targets::tar_read(tot_est_stat_tns_yr_output), 
                  align = 'c' , 
                  booktabs = TRUE) |>
  kableExtra::kable_styling()
```

And with densities (kg per km^2^ and per year): 
```{r  echo=FALSE, fig.align="center"}
# to disable scientific notations
options(scipen = 999)


kableExtra::kable(targets::tar_read(tot_est_stat_kg_km2_yr_output), 
                  align = 'c' , 
                  booktabs = TRUE) |>
  kableExtra::kable_styling()
```

We can take a look at this on a graph, with densities to be able to compare between areas 

```{r  echo=FALSE, fig.align="center"}

targets::tar_read(fig_tot_exc_all_areas_facetperel)
```

We can visualize better with all elements on one facet, using a log10 transformation on the y scale 

```{r  echo=FALSE, fig.align="center"}
targets::tar_read(fig_tot_exc_all_areas_log10)
```

However, this raise the question of weather or not the differences between areas are significant or not. Basic statistical test would not work in our case as we have a high number of "observations", so that it would always come out as statistically different even if there is small overlap. So instead, we conducted a test "by hand", and quantified in how many cases the excretion in area A was superior to that of area B. If it was in more than 98% of cases, we considered it significantly different (and the test was positive). This test should be conducted for all elements, ideally. But as we can see on the above graphs, differences between areas tend to follow the same pattern for each elements, with small variations. So here are te results of the test for N excretion:

Here are the results for N excretion:

```{r  echo=FALSE, fig.align="center"}
# to disable scientific notations
options(scipen = 999)

knitr::kable(targets::tar_read(test_diff_tot_exc_N) |>
  dplyr::mutate(`Central North Atlantic` = dplyr::case_when(is.na(`Central North Atlantic`) ~ 0, 
                                              TRUE ~ `Central North Atlantic`), 
         `Northeast Atlantic` = dplyr::case_when(is.na(`Northeast Atlantic`) ~ 0, 
                                          TRUE ~ `Northeast Atlantic`),
         `Northwest Atlantic` = dplyr::case_when(is.na(`Northwest Atlantic`) ~ 0, 
                                          TRUE ~ `Northwest Atlantic`),
         `California current` = dplyr::case_when(is.na(`California current`) ~ 0, 
                                          TRUE ~ `California current`),
         `Mediterranean Sea` = dplyr::case_when(is.na(`Mediterranean Sea`) ~ 0, 
                                         TRUE ~ `Mediterranean Sea`),
         `West Indian ocean` = dplyr::case_when(is.na(`West Indian ocean`) ~ 0, 
                                    TRUE ~ `West Indian ocean`),
         `Gulf of Mexico`  = dplyr::case_when(is.na(`Gulf of Mexico`) ~ 0, 
                                       TRUE ~ `Gulf of Mexico`),
         `French Antilles` = dplyr::case_when(is.na(`French Antilles`) ~ 0, 
                                TRUE ~ `French Antilles`),
         `New Caledonia`  = dplyr::case_when(is.na(`New Caledonia`) ~ 0, 
                                      TRUE ~ `New Caledonia`),
         `Hawaii` = dplyr::case_when(is.na(`Hawaii`) ~ 0, 
                              TRUE ~ `Hawaii`),
         `French Guyana` = dplyr::case_when(is.na(`French Guyana`) ~ 0, 
                              TRUE ~ `French Guyana`)    ,
         `Wallis & Futuna` = dplyr::case_when(is.na(`Wallis & Futuna`) ~ 0, 
                                       TRUE ~ `Wallis & Futuna`),
         `French Polynesia` = dplyr::case_when(is.na(`French Polynesia`) ~ 0, 
                                        TRUE ~ `French Polynesia`)) |>
  dplyr::mutate(`Central North Atlantic` = kableExtra::cell_spec(`Central North Atlantic`, color = ifelse(`Central North Atlantic` > 0.98, "#EE6363","black")), 
         `Northeast Atlantic` = kableExtra::cell_spec(`Northeast Atlantic`, color = ifelse(`Northeast Atlantic` > 0.98, "#EE6363","black")),
         `Northwest Atlantic` = kableExtra::cell_spec(`Northwest Atlantic`, color = ifelse(`Northwest Atlantic` > 0.98, "#EE6363","black")),
         `California current` = kableExtra::cell_spec(`California current`, color = ifelse(`California current` > 0.98, "#EE6363","black")),
         `Mediterranean Sea` = kableExtra::cell_spec(`Mediterranean Sea`, color = ifelse(`Mediterranean Sea` > 0.98, "#EE6363","black")),
         `West Indian ocean` = kableExtra::cell_spec(`West Indian ocean`, color = ifelse(`West Indian ocean` > 0.98, "#EE6363","black")),
         `Gulf of Mexico` = kableExtra::cell_spec(`Gulf of Mexico`, color = ifelse(`Gulf of Mexico` > 0.98, "#EE6363","black")),
         `French Antilles` = kableExtra::cell_spec(`French Antilles`, color = ifelse(`French Antilles` > 0.98, "#EE6363","black")),
         `New Caledonia` = kableExtra::cell_spec(`New Caledonia`, color = ifelse(`New Caledonia` > 0.98, "#EE6363","black")),
         `Hawaii` = kableExtra::cell_spec(`Hawaii`, color = ifelse(`Hawaii` > 0.98, "#EE6363","black")),
         `French Guyana` = kableExtra::cell_spec(`French Guyana`, color = ifelse(`French Guyana` > 0.98, "#EE6363","black")),
         `Wallis & Futuna` = kableExtra::cell_spec(`Wallis & Futuna`, color = ifelse(`Wallis & Futuna` > 0.98, "#EE6363","black")),
         `French Polynesia` = kableExtra::cell_spec(`French Polynesia`, color = ifelse(`French Polynesia` > 0.98, "#EE6363","black"))), 
  escape = FALSE, 
  digits = 2,
  caption = "Statistical test results - if excretion in the area in row is significantely superior to the area in column, result of the test is > 0.98 and colored in red") |>
  kableExtra::kable_styling()


```


And for P excretion: 

```{r  echo=FALSE, fig.align="center"}
# to disable scientific notations
options(scipen = 999)

knitr::kable(targets::tar_read(test_diff_tot_exc_P) |>
  dplyr::mutate(`Central North Atlantic` = dplyr::case_when(is.na(`Central North Atlantic`) ~ 0, 
                                              TRUE ~ `Central North Atlantic`), 
         `Northeast Atlantic` = dplyr::case_when(is.na(`Northeast Atlantic`) ~ 0, 
                                          TRUE ~ `Northeast Atlantic`),
         `Northwest Atlantic` = dplyr::case_when(is.na(`Northwest Atlantic`) ~ 0, 
                                          TRUE ~ `Northwest Atlantic`),
         `California current` = dplyr::case_when(is.na(`California current`) ~ 0, 
                                          TRUE ~ `California current`),
         `Mediterranean Sea` = dplyr::case_when(is.na(`Mediterranean Sea`) ~ 0, 
                                         TRUE ~ `Mediterranean Sea`),
         `West Indian ocean` = dplyr::case_when(is.na(`West Indian ocean`) ~ 0, 
                                    TRUE ~ `West Indian ocean`),
         `Gulf of Mexico`  = dplyr::case_when(is.na(`Gulf of Mexico`) ~ 0, 
                                       TRUE ~ `Gulf of Mexico`),
         `French Antilles` = dplyr::case_when(is.na(`French Antilles`) ~ 0, 
                                TRUE ~ `French Antilles`),
         `New Caledonia`  = dplyr::case_when(is.na(`New Caledonia`) ~ 0, 
                                      TRUE ~ `New Caledonia`),
         `Hawaii` = dplyr::case_when(is.na(`Hawaii`) ~ 0, 
                              TRUE ~ `Hawaii`),
         `French Guyana` = dplyr::case_when(is.na(`French Guyana`) ~ 0, 
                              TRUE ~ `French Guyana`)    ,
         `Wallis & Futuna` = dplyr::case_when(is.na(`Wallis & Futuna`) ~ 0, 
                                       TRUE ~ `Wallis & Futuna`),
         `French Polynesia` = dplyr::case_when(is.na(`French Polynesia`) ~ 0, 
                                        TRUE ~ `French Polynesia`)) |>
  dplyr::mutate(`Central North Atlantic` = kableExtra::cell_spec(`Central North Atlantic`, color = ifelse(`Central North Atlantic` > 0.98, "#EE6363","black")), 
         `Northeast Atlantic` = kableExtra::cell_spec(`Northeast Atlantic`, color = ifelse(`Northeast Atlantic` > 0.98, "#EE6363","black")),
         `Northwest Atlantic` = kableExtra::cell_spec(`Northwest Atlantic`, color = ifelse(`Northwest Atlantic` > 0.98, "#EE6363","black")),
         `California current` = kableExtra::cell_spec(`California current`, color = ifelse(`California current` > 0.98, "#EE6363","black")),
         `Mediterranean Sea` = kableExtra::cell_spec(`Mediterranean Sea`, color = ifelse(`Mediterranean Sea` > 0.98, "#EE6363","black")),
         `West Indian ocean` = kableExtra::cell_spec(`West Indian ocean`, color = ifelse(`West Indian ocean` > 0.98, "#EE6363","black")),
         `Gulf of Mexico` = kableExtra::cell_spec(`Gulf of Mexico`, color = ifelse(`Gulf of Mexico` > 0.98, "#EE6363","black")),
         `French Antilles` = kableExtra::cell_spec(`French Antilles`, color = ifelse(`French Antilles` > 0.98, "#EE6363","black")),
         `New Caledonia` = kableExtra::cell_spec(`New Caledonia`, color = ifelse(`New Caledonia` > 0.98, "#EE6363","black")),
         `Hawaii` = kableExtra::cell_spec(`Hawaii`, color = ifelse(`Hawaii` > 0.98, "#EE6363","black")),
         `French Guyana` = kableExtra::cell_spec(`French Guyana`, color = ifelse(`French Guyana` > 0.98, "#EE6363","black")),
         `Wallis & Futuna` = kableExtra::cell_spec(`Wallis & Futuna`, color = ifelse(`Wallis & Futuna` > 0.98, "#EE6363","black")),
         `French Polynesia` = kableExtra::cell_spec(`French Polynesia`, color = ifelse(`French Polynesia` > 0.98, "#EE6363","black"))), 
  escape = FALSE, 
  digits = 2,
  caption = "Statistical test results - if excretion in the area in row is significantely superior to the area in column, result of the test is > 0.98 and colored in red") |>
  kableExtra::kable_styling()
```


And for Fe excretion: 

```{r  echo=FALSE, fig.align="center"}
# to disable scientific notations
options(scipen = 999)

knitr::kable(targets::tar_read(test_diff_tot_exc_Fe) |>
  dplyr::mutate(`Central North Atlantic` = dplyr::case_when(is.na(`Central North Atlantic`) ~ 0, 
                                              TRUE ~ `Central North Atlantic`), 
         `Northeast Atlantic` = dplyr::case_when(is.na(`Northeast Atlantic`) ~ 0, 
                                          TRUE ~ `Northeast Atlantic`),
         `Northwest Atlantic` = dplyr::case_when(is.na(`Northwest Atlantic`) ~ 0, 
                                          TRUE ~ `Northwest Atlantic`),
         `California current` = dplyr::case_when(is.na(`California current`) ~ 0, 
                                          TRUE ~ `California current`),
         `Mediterranean Sea` = dplyr::case_when(is.na(`Mediterranean Sea`) ~ 0, 
                                         TRUE ~ `Mediterranean Sea`),
         `West Indian ocean` = dplyr::case_when(is.na(`West Indian ocean`) ~ 0, 
                                    TRUE ~ `West Indian ocean`),
         `Gulf of Mexico`  = dplyr::case_when(is.na(`Gulf of Mexico`) ~ 0, 
                                       TRUE ~ `Gulf of Mexico`),
         `French Antilles` = dplyr::case_when(is.na(`French Antilles`) ~ 0, 
                                TRUE ~ `French Antilles`),
         `New Caledonia`  = dplyr::case_when(is.na(`New Caledonia`) ~ 0, 
                                      TRUE ~ `New Caledonia`),
         `Hawaii` = dplyr::case_when(is.na(`Hawaii`) ~ 0, 
                              TRUE ~ `Hawaii`),
         `French Guyana` = dplyr::case_when(is.na(`French Guyana`) ~ 0, 
                              TRUE ~ `French Guyana`)    ,
         `Wallis & Futuna` = dplyr::case_when(is.na(`Wallis & Futuna`) ~ 0, 
                                       TRUE ~ `Wallis & Futuna`),
         `French Polynesia` = dplyr::case_when(is.na(`French Polynesia`) ~ 0, 
                                        TRUE ~ `French Polynesia`)) |>
  dplyr::mutate(`Central North Atlantic` = kableExtra::cell_spec(`Central North Atlantic`, color = ifelse(`Central North Atlantic` > 0.98, "#EE6363","black")), 
         `Northeast Atlantic` = kableExtra::cell_spec(`Northeast Atlantic`, color = ifelse(`Northeast Atlantic` > 0.98, "#EE6363","black")),
         `Northwest Atlantic` = kableExtra::cell_spec(`Northwest Atlantic`, color = ifelse(`Northwest Atlantic` > 0.98, "#EE6363","black")),
         `California current` = kableExtra::cell_spec(`California current`, color = ifelse(`California current` > 0.98, "#EE6363","black")),
         `Mediterranean Sea` = kableExtra::cell_spec(`Mediterranean Sea`, color = ifelse(`Mediterranean Sea` > 0.98, "#EE6363","black")),
         `West Indian ocean` = kableExtra::cell_spec(`West Indian ocean`, color = ifelse(`West Indian ocean` > 0.98, "#EE6363","black")),
         `Gulf of Mexico` = kableExtra::cell_spec(`Gulf of Mexico`, color = ifelse(`Gulf of Mexico` > 0.98, "#EE6363","black")),
         `French Antilles` = kableExtra::cell_spec(`French Antilles`, color = ifelse(`French Antilles` > 0.98, "#EE6363","black")),
         `New Caledonia` = kableExtra::cell_spec(`New Caledonia`, color = ifelse(`New Caledonia` > 0.98, "#EE6363","black")),
         `Hawaii` = kableExtra::cell_spec(`Hawaii`, color = ifelse(`Hawaii` > 0.98, "#EE6363","black")),
         `French Guyana` = kableExtra::cell_spec(`French Guyana`, color = ifelse(`French Guyana` > 0.98, "#EE6363","black")),
         `Wallis & Futuna` = kableExtra::cell_spec(`Wallis & Futuna`, color = ifelse(`Wallis & Futuna` > 0.98, "#EE6363","black")),
         `French Polynesia` = kableExtra::cell_spec(`French Polynesia`, color = ifelse(`French Polynesia` > 0.98, "#EE6363","black"))), 
  escape = FALSE, 
  digits = 2,
  caption = "Statistical test results - if excretion in the area in row is significantely superior to the area in column, result of the test is > 0.98 and colored in red") |>
  kableExtra::kable_styling()
```



And for Cu excretion: 

```{r  echo=FALSE, fig.align="center"}
# to disable scientific notations
options(scipen = 999)

knitr::kable(targets::tar_read(test_diff_tot_exc_Cu) |>
  dplyr::mutate(`Central North Atlantic` = dplyr::case_when(is.na(`Central North Atlantic`) ~ 0, 
                                              TRUE ~ `Central North Atlantic`), 
         `Northeast Atlantic` = dplyr::case_when(is.na(`Northeast Atlantic`) ~ 0, 
                                          TRUE ~ `Northeast Atlantic`),
         `Northwest Atlantic` = dplyr::case_when(is.na(`Northwest Atlantic`) ~ 0, 
                                          TRUE ~ `Northwest Atlantic`),
         `California current` = dplyr::case_when(is.na(`California current`) ~ 0, 
                                          TRUE ~ `California current`),
         `Mediterranean Sea` = dplyr::case_when(is.na(`Mediterranean Sea`) ~ 0, 
                                         TRUE ~ `Mediterranean Sea`),
         `West Indian ocean` = dplyr::case_when(is.na(`West Indian ocean`) ~ 0, 
                                    TRUE ~ `West Indian ocean`),
         `Gulf of Mexico`  = dplyr::case_when(is.na(`Gulf of Mexico`) ~ 0, 
                                       TRUE ~ `Gulf of Mexico`),
         `French Antilles` = dplyr::case_when(is.na(`French Antilles`) ~ 0, 
                                TRUE ~ `French Antilles`),
         `New Caledonia`  = dplyr::case_when(is.na(`New Caledonia`) ~ 0, 
                                      TRUE ~ `New Caledonia`),
         `Hawaii` = dplyr::case_when(is.na(`Hawaii`) ~ 0, 
                              TRUE ~ `Hawaii`),
         `French Guyana` = dplyr::case_when(is.na(`French Guyana`) ~ 0, 
                              TRUE ~ `French Guyana`)    ,
         `Wallis & Futuna` = dplyr::case_when(is.na(`Wallis & Futuna`) ~ 0, 
                                       TRUE ~ `Wallis & Futuna`),
         `French Polynesia` = dplyr::case_when(is.na(`French Polynesia`) ~ 0, 
                                        TRUE ~ `French Polynesia`)) |>
  dplyr::mutate(`Central North Atlantic` = kableExtra::cell_spec(`Central North Atlantic`, color = ifelse(`Central North Atlantic` > 0.98, "#EE6363","black")), 
         `Northeast Atlantic` = kableExtra::cell_spec(`Northeast Atlantic`, color = ifelse(`Northeast Atlantic` > 0.98, "#EE6363","black")),
         `Northwest Atlantic` = kableExtra::cell_spec(`Northwest Atlantic`, color = ifelse(`Northwest Atlantic` > 0.98, "#EE6363","black")),
         `California current` = kableExtra::cell_spec(`California current`, color = ifelse(`California current` > 0.98, "#EE6363","black")),
         `Mediterranean Sea` = kableExtra::cell_spec(`Mediterranean Sea`, color = ifelse(`Mediterranean Sea` > 0.98, "#EE6363","black")),
         `West Indian ocean` = kableExtra::cell_spec(`West Indian ocean`, color = ifelse(`West Indian ocean` > 0.98, "#EE6363","black")),
         `Gulf of Mexico` = kableExtra::cell_spec(`Gulf of Mexico`, color = ifelse(`Gulf of Mexico` > 0.98, "#EE6363","black")),
         `French Antilles` = kableExtra::cell_spec(`French Antilles`, color = ifelse(`French Antilles` > 0.98, "#EE6363","black")),
         `New Caledonia` = kableExtra::cell_spec(`New Caledonia`, color = ifelse(`New Caledonia` > 0.98, "#EE6363","black")),
         `Hawaii` = kableExtra::cell_spec(`Hawaii`, color = ifelse(`Hawaii` > 0.98, "#EE6363","black")),
         `French Guyana` = kableExtra::cell_spec(`French Guyana`, color = ifelse(`French Guyana` > 0.98, "#EE6363","black")),
         `Wallis & Futuna` = kableExtra::cell_spec(`Wallis & Futuna`, color = ifelse(`Wallis & Futuna` > 0.98, "#EE6363","black")),
         `French Polynesia` = kableExtra::cell_spec(`French Polynesia`, color = ifelse(`French Polynesia` > 0.98, "#EE6363","black"))), 
  escape = FALSE, 
  digits = 2,
  caption = "Statistical test results - if excretion in the area in row is significantely superior to the area in column, result of the test is > 0.98 and colored in red") |>
  kableExtra::kable_styling()
```



And for Mn excretion: 

```{r  echo=FALSE, fig.align="center"}
# to disable scientific notations
options(scipen = 999)

knitr::kable(targets::tar_read(test_diff_tot_exc_Mn) |>
  dplyr::mutate(`Central North Atlantic` = dplyr::case_when(is.na(`Central North Atlantic`) ~ 0, 
                                              TRUE ~ `Central North Atlantic`), 
         `Northeast Atlantic` = dplyr::case_when(is.na(`Northeast Atlantic`) ~ 0, 
                                          TRUE ~ `Northeast Atlantic`),
         `Northwest Atlantic` = dplyr::case_when(is.na(`Northwest Atlantic`) ~ 0, 
                                          TRUE ~ `Northwest Atlantic`),
         `California current` = dplyr::case_when(is.na(`California current`) ~ 0, 
                                          TRUE ~ `California current`),
         `Mediterranean Sea` = dplyr::case_when(is.na(`Mediterranean Sea`) ~ 0, 
                                         TRUE ~ `Mediterranean Sea`),
         `West Indian ocean` = dplyr::case_when(is.na(`West Indian ocean`) ~ 0, 
                                    TRUE ~ `West Indian ocean`),
         `Gulf of Mexico`  = dplyr::case_when(is.na(`Gulf of Mexico`) ~ 0, 
                                       TRUE ~ `Gulf of Mexico`),
         `French Antilles` = dplyr::case_when(is.na(`French Antilles`) ~ 0, 
                                TRUE ~ `French Antilles`),
         `New Caledonia`  = dplyr::case_when(is.na(`New Caledonia`) ~ 0, 
                                      TRUE ~ `New Caledonia`),
         `Hawaii` = dplyr::case_when(is.na(`Hawaii`) ~ 0, 
                              TRUE ~ `Hawaii`),
         `French Guyana` = dplyr::case_when(is.na(`French Guyana`) ~ 0, 
                              TRUE ~ `French Guyana`)    ,
         `Wallis & Futuna` = dplyr::case_when(is.na(`Wallis & Futuna`) ~ 0, 
                                       TRUE ~ `Wallis & Futuna`),
         `French Polynesia` = dplyr::case_when(is.na(`French Polynesia`) ~ 0, 
                                        TRUE ~ `French Polynesia`)) |>
  dplyr::mutate(`Central North Atlantic` = kableExtra::cell_spec(`Central North Atlantic`, color = ifelse(`Central North Atlantic` > 0.98, "#EE6363","black")), 
         `Northeast Atlantic` = kableExtra::cell_spec(`Northeast Atlantic`, color = ifelse(`Northeast Atlantic` > 0.98, "#EE6363","black")),
         `Northwest Atlantic` = kableExtra::cell_spec(`Northwest Atlantic`, color = ifelse(`Northwest Atlantic` > 0.98, "#EE6363","black")),
         `California current` = kableExtra::cell_spec(`California current`, color = ifelse(`California current` > 0.98, "#EE6363","black")),
         `Mediterranean Sea` = kableExtra::cell_spec(`Mediterranean Sea`, color = ifelse(`Mediterranean Sea` > 0.98, "#EE6363","black")),
         `West Indian ocean` = kableExtra::cell_spec(`West Indian ocean`, color = ifelse(`West Indian ocean` > 0.98, "#EE6363","black")),
         `Gulf of Mexico` = kableExtra::cell_spec(`Gulf of Mexico`, color = ifelse(`Gulf of Mexico` > 0.98, "#EE6363","black")),
         `French Antilles` = kableExtra::cell_spec(`French Antilles`, color = ifelse(`French Antilles` > 0.98, "#EE6363","black")),
         `New Caledonia` = kableExtra::cell_spec(`New Caledonia`, color = ifelse(`New Caledonia` > 0.98, "#EE6363","black")),
         `Hawaii` = kableExtra::cell_spec(`Hawaii`, color = ifelse(`Hawaii` > 0.98, "#EE6363","black")),
         `French Guyana` = kableExtra::cell_spec(`French Guyana`, color = ifelse(`French Guyana` > 0.98, "#EE6363","black")),
         `Wallis & Futuna` = kableExtra::cell_spec(`Wallis & Futuna`, color = ifelse(`Wallis & Futuna` > 0.98, "#EE6363","black")),
         `French Polynesia` = kableExtra::cell_spec(`French Polynesia`, color = ifelse(`French Polynesia` > 0.98, "#EE6363","black"))), 
  escape = FALSE, 
  digits = 2,
  caption = "Statistical test results - if excretion in the area in row is significantely superior to the area in column, result of the test is > 0.98 and colored in red") |>
  kableExtra::kable_styling()
```



And for Se excretion: 

```{r  echo=FALSE, fig.align="center"}
# to disable scientific notations
options(scipen = 999)

knitr::kable(targets::tar_read(test_diff_tot_exc_Se) |>
  dplyr::mutate(`Central North Atlantic` = dplyr::case_when(is.na(`Central North Atlantic`) ~ 0, 
                                              TRUE ~ `Central North Atlantic`), 
         `Northeast Atlantic` = dplyr::case_when(is.na(`Northeast Atlantic`) ~ 0, 
                                          TRUE ~ `Northeast Atlantic`),
         `Northwest Atlantic` = dplyr::case_when(is.na(`Northwest Atlantic`) ~ 0, 
                                          TRUE ~ `Northwest Atlantic`),
         `California current` = dplyr::case_when(is.na(`California current`) ~ 0, 
                                          TRUE ~ `California current`),
         `Mediterranean Sea` = dplyr::case_when(is.na(`Mediterranean Sea`) ~ 0, 
                                         TRUE ~ `Mediterranean Sea`),
         `West Indian ocean` = dplyr::case_when(is.na(`West Indian ocean`) ~ 0, 
                                    TRUE ~ `West Indian ocean`),
         `Gulf of Mexico`  = dplyr::case_when(is.na(`Gulf of Mexico`) ~ 0, 
                                       TRUE ~ `Gulf of Mexico`),
         `French Antilles` = dplyr::case_when(is.na(`French Antilles`) ~ 0, 
                                TRUE ~ `French Antilles`),
         `New Caledonia`  = dplyr::case_when(is.na(`New Caledonia`) ~ 0, 
                                      TRUE ~ `New Caledonia`),
         `Hawaii` = dplyr::case_when(is.na(`Hawaii`) ~ 0, 
                              TRUE ~ `Hawaii`),
         `French Guyana` = dplyr::case_when(is.na(`French Guyana`) ~ 0, 
                              TRUE ~ `French Guyana`)    ,
         `Wallis & Futuna` = dplyr::case_when(is.na(`Wallis & Futuna`) ~ 0, 
                                       TRUE ~ `Wallis & Futuna`),
         `French Polynesia` = dplyr::case_when(is.na(`French Polynesia`) ~ 0, 
                                        TRUE ~ `French Polynesia`)) |>
  dplyr::mutate(`Central North Atlantic` = kableExtra::cell_spec(`Central North Atlantic`, color = ifelse(`Central North Atlantic` > 0.98, "#EE6363","black")), 
         `Northeast Atlantic` = kableExtra::cell_spec(`Northeast Atlantic`, color = ifelse(`Northeast Atlantic` > 0.98, "#EE6363","black")),
         `Northwest Atlantic` = kableExtra::cell_spec(`Northwest Atlantic`, color = ifelse(`Northwest Atlantic` > 0.98, "#EE6363","black")),
         `California current` = kableExtra::cell_spec(`California current`, color = ifelse(`California current` > 0.98, "#EE6363","black")),
         `Mediterranean Sea` = kableExtra::cell_spec(`Mediterranean Sea`, color = ifelse(`Mediterranean Sea` > 0.98, "#EE6363","black")),
         `West Indian ocean` = kableExtra::cell_spec(`West Indian ocean`, color = ifelse(`West Indian ocean` > 0.98, "#EE6363","black")),
         `Gulf of Mexico` = kableExtra::cell_spec(`Gulf of Mexico`, color = ifelse(`Gulf of Mexico` > 0.98, "#EE6363","black")),
         `French Antilles` = kableExtra::cell_spec(`French Antilles`, color = ifelse(`French Antilles` > 0.98, "#EE6363","black")),
         `New Caledonia` = kableExtra::cell_spec(`New Caledonia`, color = ifelse(`New Caledonia` > 0.98, "#EE6363","black")),
         `Hawaii` = kableExtra::cell_spec(`Hawaii`, color = ifelse(`Hawaii` > 0.98, "#EE6363","black")),
         `French Guyana` = kableExtra::cell_spec(`French Guyana`, color = ifelse(`French Guyana` > 0.98, "#EE6363","black")),
         `Wallis & Futuna` = kableExtra::cell_spec(`Wallis & Futuna`, color = ifelse(`Wallis & Futuna` > 0.98, "#EE6363","black")),
         `French Polynesia` = kableExtra::cell_spec(`French Polynesia`, color = ifelse(`French Polynesia` > 0.98, "#EE6363","black"))), 
  escape = FALSE, 
  digits = 2,
  caption = "Statistical test results - if excretion in the area in row is significantely superior to the area in column, result of the test is > 0.98 and colored in red") |>
  kableExtra::kable_styling()
```


And for Zn excretion: 

```{r  echo=FALSE, fig.align="center"}
# to disable scientific notations
options(scipen = 999)

knitr::kable(targets::tar_read(test_diff_tot_exc_Zn) |>
  dplyr::mutate(`Central North Atlantic` = dplyr::case_when(is.na(`Central North Atlantic`) ~ 0, 
                                              TRUE ~ `Central North Atlantic`), 
         `Northeast Atlantic` = dplyr::case_when(is.na(`Northeast Atlantic`) ~ 0, 
                                          TRUE ~ `Northeast Atlantic`),
         `Northwest Atlantic` = dplyr::case_when(is.na(`Northwest Atlantic`) ~ 0, 
                                          TRUE ~ `Northwest Atlantic`),
         `California current` = dplyr::case_when(is.na(`California current`) ~ 0, 
                                          TRUE ~ `California current`),
         `Mediterranean Sea` = dplyr::case_when(is.na(`Mediterranean Sea`) ~ 0, 
                                         TRUE ~ `Mediterranean Sea`),
         `West Indian ocean` = dplyr::case_when(is.na(`West Indian ocean`) ~ 0, 
                                    TRUE ~ `West Indian ocean`),
         `Gulf of Mexico`  = dplyr::case_when(is.na(`Gulf of Mexico`) ~ 0, 
                                       TRUE ~ `Gulf of Mexico`),
         `French Antilles` = dplyr::case_when(is.na(`French Antilles`) ~ 0, 
                                TRUE ~ `French Antilles`),
         `New Caledonia`  = dplyr::case_when(is.na(`New Caledonia`) ~ 0, 
                                      TRUE ~ `New Caledonia`),
         `Hawaii` = dplyr::case_when(is.na(`Hawaii`) ~ 0, 
                              TRUE ~ `Hawaii`),
         `French Guyana` = dplyr::case_when(is.na(`French Guyana`) ~ 0, 
                              TRUE ~ `French Guyana`)    ,
         `Wallis & Futuna` = dplyr::case_when(is.na(`Wallis & Futuna`) ~ 0, 
                                       TRUE ~ `Wallis & Futuna`),
         `French Polynesia` = dplyr::case_when(is.na(`French Polynesia`) ~ 0, 
                                        TRUE ~ `French Polynesia`)) |>
  dplyr::mutate(`Central North Atlantic` = kableExtra::cell_spec(`Central North Atlantic`, color = ifelse(`Central North Atlantic` > 0.98, "#EE6363","black")), 
         `Northeast Atlantic` = kableExtra::cell_spec(`Northeast Atlantic`, color = ifelse(`Northeast Atlantic` > 0.98, "#EE6363","black")),
         `Northwest Atlantic` = kableExtra::cell_spec(`Northwest Atlantic`, color = ifelse(`Northwest Atlantic` > 0.98, "#EE6363","black")),
         `California current` = kableExtra::cell_spec(`California current`, color = ifelse(`California current` > 0.98, "#EE6363","black")),
         `Mediterranean Sea` = kableExtra::cell_spec(`Mediterranean Sea`, color = ifelse(`Mediterranean Sea` > 0.98, "#EE6363","black")),
         `West Indian ocean` = kableExtra::cell_spec(`West Indian ocean`, color = ifelse(`West Indian ocean` > 0.98, "#EE6363","black")),
         `Gulf of Mexico` = kableExtra::cell_spec(`Gulf of Mexico`, color = ifelse(`Gulf of Mexico` > 0.98, "#EE6363","black")),
         `French Antilles` = kableExtra::cell_spec(`French Antilles`, color = ifelse(`French Antilles` > 0.98, "#EE6363","black")),
         `New Caledonia` = kableExtra::cell_spec(`New Caledonia`, color = ifelse(`New Caledonia` > 0.98, "#EE6363","black")),
         `Hawaii` = kableExtra::cell_spec(`Hawaii`, color = ifelse(`Hawaii` > 0.98, "#EE6363","black")),
         `French Guyana` = kableExtra::cell_spec(`French Guyana`, color = ifelse(`French Guyana` > 0.98, "#EE6363","black")),
         `Wallis & Futuna` = kableExtra::cell_spec(`Wallis & Futuna`, color = ifelse(`Wallis & Futuna` > 0.98, "#EE6363","black")),
         `French Polynesia` = kableExtra::cell_spec(`French Polynesia`, color = ifelse(`French Polynesia` > 0.98, "#EE6363","black"))), 
  escape = FALSE, 
  digits = 2,
  caption = "Statistical test results - if excretion in the area in row is significantely superior to the area in column, result of the test is > 0.98 and colored in red") |>
  kableExtra::kable_styling()
```



And, finally, for Co excretion: 

```{r  echo=FALSE, fig.align="center"}
# to disable scientific notations
options(scipen = 999)

knitr::kable(targets::tar_read(test_diff_tot_exc_Co) |>
  dplyr::mutate(`Central North Atlantic` = dplyr::case_when(is.na(`Central North Atlantic`) ~ 0, 
                                              TRUE ~ `Central North Atlantic`), 
         `Northeast Atlantic` = dplyr::case_when(is.na(`Northeast Atlantic`) ~ 0, 
                                          TRUE ~ `Northeast Atlantic`),
         `Northwest Atlantic` = dplyr::case_when(is.na(`Northwest Atlantic`) ~ 0, 
                                          TRUE ~ `Northwest Atlantic`),
         `California current` = dplyr::case_when(is.na(`California current`) ~ 0, 
                                          TRUE ~ `California current`),
         `Mediterranean Sea` = dplyr::case_when(is.na(`Mediterranean Sea`) ~ 0, 
                                         TRUE ~ `Mediterranean Sea`),
         `West Indian ocean` = dplyr::case_when(is.na(`West Indian ocean`) ~ 0, 
                                    TRUE ~ `West Indian ocean`),
         `Gulf of Mexico`  = dplyr::case_when(is.na(`Gulf of Mexico`) ~ 0, 
                                       TRUE ~ `Gulf of Mexico`),
         `French Antilles` = dplyr::case_when(is.na(`French Antilles`) ~ 0, 
                                TRUE ~ `French Antilles`),
         `New Caledonia`  = dplyr::case_when(is.na(`New Caledonia`) ~ 0, 
                                      TRUE ~ `New Caledonia`),
         `Hawaii` = dplyr::case_when(is.na(`Hawaii`) ~ 0, 
                              TRUE ~ `Hawaii`),
         `French Guyana` = dplyr::case_when(is.na(`French Guyana`) ~ 0, 
                              TRUE ~ `French Guyana`)    ,
         `Wallis & Futuna` = dplyr::case_when(is.na(`Wallis & Futuna`) ~ 0, 
                                       TRUE ~ `Wallis & Futuna`),
         `French Polynesia` = dplyr::case_when(is.na(`French Polynesia`) ~ 0, 
                                        TRUE ~ `French Polynesia`)) |>
  dplyr::mutate(`Central North Atlantic` = kableExtra::cell_spec(`Central North Atlantic`, color = ifelse(`Central North Atlantic` > 0.98, "#EE6363","black")), 
         `Northeast Atlantic` = kableExtra::cell_spec(`Northeast Atlantic`, color = ifelse(`Northeast Atlantic` > 0.98, "#EE6363","black")),
         `Northwest Atlantic` = kableExtra::cell_spec(`Northwest Atlantic`, color = ifelse(`Northwest Atlantic` > 0.98, "#EE6363","black")),
         `California current` = kableExtra::cell_spec(`California current`, color = ifelse(`California current` > 0.98, "#EE6363","black")),
         `Mediterranean Sea` = kableExtra::cell_spec(`Mediterranean Sea`, color = ifelse(`Mediterranean Sea` > 0.98, "#EE6363","black")),
         `West Indian ocean` = kableExtra::cell_spec(`West Indian ocean`, color = ifelse(`West Indian ocean` > 0.98, "#EE6363","black")),
         `Gulf of Mexico` = kableExtra::cell_spec(`Gulf of Mexico`, color = ifelse(`Gulf of Mexico` > 0.98, "#EE6363","black")),
         `French Antilles` = kableExtra::cell_spec(`French Antilles`, color = ifelse(`French Antilles` > 0.98, "#EE6363","black")),
         `New Caledonia` = kableExtra::cell_spec(`New Caledonia`, color = ifelse(`New Caledonia` > 0.98, "#EE6363","black")),
         `Hawaii` = kableExtra::cell_spec(`Hawaii`, color = ifelse(`Hawaii` > 0.98, "#EE6363","black")),
         `French Guyana` = kableExtra::cell_spec(`French Guyana`, color = ifelse(`French Guyana` > 0.98, "#EE6363","black")),
         `Wallis & Futuna` = kableExtra::cell_spec(`Wallis & Futuna`, color = ifelse(`Wallis & Futuna` > 0.98, "#EE6363","black")),
         `French Polynesia` = kableExtra::cell_spec(`French Polynesia`, color = ifelse(`French Polynesia` > 0.98, "#EE6363","black"))), 
  escape = FALSE, 
  digits = 2,
  caption = "Statistical test results - if excretion in the area in row is significantely superior to the area in column, result of the test is > 0.98 and colored in red") |>
  kableExtra::kable_styling()
```


So in the end, most differences are significant or close to be, even if it is not obvious when looking at the graph. N excretion (in density) is rather equivalent in the three areas where it is maximum: the Gulf of Alaska, the Central North Atlantic and Northeast Atlantic. The level of excretion in the Mediterranean Sea is significantly below other areas of the same latitude, but just 95% of its values are above that of the Indian ocean, then it is significantly above all other areas. Excretion in French Polynesia is significantly below excretion in all other areas considered.

Even if we considered densities, we can wonder if there is a bias of the size of areas considered. We could imagine for instance that the smaller the area, the smaller the chance to spot different species, for instance. So we can take a look at respective surfaces:

```{r  echo=FALSE, fig.align="center"}
# to disable scientific notations
options(scipen = 999)


kableExtra::kable(targets::tar_read(surf_tot_areas), 
                  align = 'c' , 
                  booktabs = TRUE) |>
  kableExtra::kable_styling()
```

It does not seem so, but we can take a look at it on a graph, for instance for N excretion:

```{r  echo=FALSE, fig.align="center"}
targets::tar_read(fig_tot_exc_vs_surfaces)
```

It does not look like results are so tied to the surfaces or the surveyed areas. 

To compare levels of excretion between areas, we computed a fold-change ratio: we considered the lowest levels of excretion (i.e. that of French Polynesia) as a reference, and for each other area we calculated how many times more each nutrient was excreted compared to French Polynesia. Here is the result table for this, the fold change being the last column "fold": 

```{r  echo=FALSE, fig.align="center"}
# to disable scientific notations
options(scipen = 999)


kableExtra::kable(targets::tar_read(table_fold_output), 
                  align = 'c' , 
                  booktabs = TRUE) |>
  kableExtra::kable_styling()
```


### All elements, separated cetacean groups

Also, considering the results overall areas, we can wonder if the order of the areas depends on the major contribution of either baleen whales, deep divers or small delphinids. 
So what happens if we look only at the contribution of small delphinids ? 

```{r  echo=FALSE, fig.align="center"}
targets::tar_read(fig_tot_exc_all_areas_facetperel_SD)
```


We can see indeed that either baleen whales or deep divers (or both) are the major contributors in the Gulf of Alaska and the Central North Atlantic, two of the areas where the densities of fertilization due to cetaceans are of the highest. There, the role of small delphinids in the fertilization of the photic zone might thus be negligible. 
However, the contribution of small delphinids seems to place higher Guyana and Wallis & Futuna. Apart from that, the order of areas is rather conserved. 
Also, something specific seems to be happening for Cu. Maybe it depends on species in the areas. For instance, we can see Cu excretion in the Mediterranean Sea get ranked higher when we consider only the contribution of small delphinids. The most abundant species of small delphinids in this area is striped dolphin, that have a diet relatively rich in cephalopods compared to other small delphinids. Cephalopods being richer in Cu than most other prey species, it could, to some extent, explain the observed pattern. 

And what happens if we look only at the contributions of deep divers ? 

```{r  echo=FALSE, fig.align="center"}
targets::tar_read(fig_tot_exc_all_areas_facetperel_DD)
```

Then it suggests that it's probably baleen whales that are the main contributors in the Gulf of Alaska, whereas in the North Atlantic deep divers are significant contributors that tend to rank the area higher. In the Northwest Atlantic and the California current however, the contribution of deep divers seems to be rather small compared to other groups. 

Finally, if we look only at the contribution of baleen whales ? 

```{r  echo=FALSE, fig.align="center"}
targets::tar_read(fig_tot_exc_all_areas_facetperel_BW)
```

First, we note that baleen whales are not present in all areas, whereas small delphinids and deep divers are. Second, we see the order is quite that of the one where we considered all ecological groups. In Hawaii, in the Mediterranean Sea and in the Gulf of Mexico, the contribution of baleen whales is rather small.

