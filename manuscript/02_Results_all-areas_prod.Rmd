---
title: "Results - correlation between excretion and productivity"
author: "Lola Gilbert"
date: "25/03/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
```

This project is available on 
_[github](https://github.com/Lola-san/Cetacean.excretion.global.git)_

# Nutrient cycling in the photic zone through cetacean populations

We show excretion by cetacean communities is heterogeneous at a large scale worldwide and that there is some kind of latitudinal pattern, lower latitudes being associated with lower levels of excretion compared to higher latitude areas being associated with highest levels of excretion. We hypothethize this heterogeneity may be correlated to difference in the productivity of ecosystems. 

### Correlation between cetacean excretion and productivity of ecosystems

Temperate waters are known as eutrophic compared to oligotrophic tropical waters. So, we can wonder if there is a link with primary production. Primary production itself is challenging to estimate on a routine at a large scale, but it is widely accepted that is can be approached through indices like chlorophyll concentration (both are positively proportional) and sea surface temperature (negatively correlated). We used chlorophyll and sst data from NEO (NASA Earth Observations, [https://oceancolor.gsfc.nasa.gov/l3/order/](https://oceancolor.gsfc.nasa.gov/l3/order/)), defined roughly the same areas where we used abundance surveys to compute estimates, to compare these data. 
We used annual mean estimates for year 2021. 

We can compare mean values and distribution of excretion, sst and chlorophyll in all areas. First for just on nutrient (as the between-area variations seem to be similar for all elements), say N:

```{r  echo=FALSE, fig.align="center"}
memory.limit(size = 25000)

targets::tar_read(fig_N_vs_sst)
```

```{r  echo=FALSE, fig.align="center"}
targets::tar_read(fig_N_vs_chloro_Guy)
```

There seems to be a negative relation between excretion and sst, for the chlorophyll also but less intense, and there is something happening with Guyana. Chlorophyll concentration esitmates are from satellite data, Guyana may pop out as an outlier because of the high turbidity of the water due to the Amazon River plume. 

Being an outlier, we can simply take it out: 

```{r  echo=FALSE, fig.align="center"}
targets::tar_read(fig_N_vs_chloro_noGuy)
```

It looks a lot better, and the relation seems to be quite strong between the two variables. 

We included 8 nutrients in our analysis, so it would be interesting to see if this relation holds for all of them. 

We can look at it with a log10 transformation on the y axis first: 

```{r  echo=FALSE, fig.align="center"}
targets::tar_read(fig_all_el_log10_vs_sst) -> p1
targets::tar_read(fig_all_el_log10_vs_chloro) -> p2
gridExtra::grid.arrange(p1, p2, ncol = 2)
```

Without the log10 transformation: 

```{r  echo=FALSE, fig.align="center"}
targets::tar_read(fig_all_el_vs_sst) -> p1
targets::tar_read(fig_all_el_vs_chloro) -> p2
gridExtra::grid.arrange(p1, p2, ncol = 2)
```

And without the log10 transformation but with normalized excretion value (normalization per element across all areas, on all raw values, then we computed means on these normalized values): 

```{r  echo=FALSE, fig.align="center"}
#targets::tar_read(fig_all_el_vs_sst_norm) -> p3
#targets::tar_read(fig_all_el_vs_chloro_norm) -> p4
#gridExtra::grid.arrange(p3, p4, ncol = 2)
```

As we compared levels of excretion between areas using a relative excretion value and fold-change ratios (as fold-change between excretion in one area compared to the excretion where the area is the lowest - French Polynesia), we think this would be interesting to test the correlation with these fold-change ratios. This is a a sort of normalization somewhat. 

```{r  echo=FALSE, fig.align="center"}
#targets::tar_read(fig_all_el_vs_sst_fold) -> p5
#targets::tar_read(fig_all_el_vs_chloro_fold) -> p6
#gridExtra::grid.arrange(p5, p6, ncol = 2)
```

We can see the pattern is the same: there are some correlations for all elements, but the intensity of the relation varies between elements. However, there are some differences compared to results with the "true" normalization. See the order of the elements lines. This can be because if French Polynesia are always minimum values (so all min are for the same areas for the normalization), maximum values are not all for the same area. The maximum values are in the Northeast Atlantic area for N, P, Fe, Mn, Se and Zn but in the Central North Atlantic for Cu and Co. 

To have more quantitative results about these correlations between levels of excretion and indicators of productivity of ecosystems, we did a bit of modelling, using simple linear models. For each element, we ran two models: 
- $$ F_{el} = f(sst)$$
- $$ F_{el} = f(chloro)$$
$$F_{el}$$ being the fold-change ratio for nutrient *el*. 

We summarize results using R^2^ and slope estimates, the slope estimate being an indicator of the intensity of the relation between the fold-change ratio and the variable, and R^2^ being an indicator of the strength of the relation between the fold-change ratio and the variable. Guyana was still considered as an outlier when working on chlorophyll concentration data, so it was excluded from the modelling. We used a log transformation for the chlorophyll concentration variable and the fold-change excretion ratio for the model with chlorophyll concentration as a covariate. 

```{r  echo=FALSE, fig.align="center"}
# to disable scientific notations
options(scipen = 999)

kableExtra::kable(targets::tar_read(tib_models_fold), 
                  align = 'c' , 
                  booktabs = TRUE) |>
  kableExtra::kable_styling()
```

And to visualize this on a graph: 

```{r  echo=FALSE, fig.align="center"}
targets::tar_read(graph_models_sst_fold) -> p7
targets::tar_read(graph_models_chloro_fold) -> p8
gridExtra::grid.arrange(p7, p8, ncol = 2)
```

Just to see if it makes a big difference, we did the same with normalized excretion data:

```{r  echo=FALSE, fig.align="center"}
# to disable scientific notations
options(scipen = 999)

kableExtra::kable(targets::tar_read(tib_models_norm), 
                  align = 'c' , 
                  booktabs = TRUE) |>
  kableExtra::kable_styling()
```

```{r  echo=FALSE, fig.align="center"}
targets::tar_read(graph_models_sst_norm) -> p9
targets::tar_read(graph_models_chloro_norm) -> p10
gridExtra::grid.arrange(p9, p10, ncol = 2)
```